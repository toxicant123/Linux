# 7.12 其他常用命令

### 7.12.1 ping 测试主机间网络连通性

ping命令的功能是用于测试主机间网络连通性，发送出基于ICMP传输协议的数据包，要求对方主机予以回复，若对方主机的网络功能没有问题且防火墙放行流量，则就会回复该信息，我们也就可得知对方主机系统在线并运行正常了。

不过值得我们注意的是Linux与Windows相比有一定差异，Windows系统下的ping命令会发送出去4个请求后自动结束该命令；而Linux系统则不会自动终止，需要用户手动按下组合键“Ctrl+c”才能结束，或是发起命令时加入-c参数限定发送个数

1. 基本语法

ping [参数] 目标主机

2. 常用参数

| 参数  |          功能          |
|:---:|:--------------------:|
| -d  | 使用Socket的SO_DEBUG功能  |
| -c  |      指定发送报文的次数       |
| -i  |     指定收发信息的间隔时间      |
| -I  |    使用指定的网络接口送出数据包    |
| -l  | 设置在送出要求信息之前，先行发出的数据包 |
| -n  |        只输出数值         |
| -p  |     设置填满数据包的范本样式     |
| -q  |      不显示指令执行过程       |
| -R  |        记录路由过程        |
| -s  |       设置数据包的大小       |
| -t  |     设置存活数值TTL的大小     |
| -v  |     详细显示指令的执行过程      |

3. 参考实例

测试与指定网站服务器之间的网络连通性（需手动按下“Ctrl+c”组合键结束命令）

```shell
ping www.linuxcool.com
```

测试与指定主机之间的网络连通性，发送3次请求包，每次间隔0.2秒，最长等待时间为3秒

```shell
ping -c 3 -i 0.2 -W 3 192.168.10.10
```

### 7.12.2 wget 下载网络文件

wget命令来自于英文词组”web get“的缩写，其功能是用于从指定网址下载网络文件。wget命令非常稳定，一般即便网络波动也不会导致下载失败，而是不断的尝试重连，直至整个文件下载完毕。

wget命令支持如HTTP、HTTPS、FTP等常见协议，可以在命令行中直接下载网络文件。

1. 基本语法

wget [参数] 网址

2. 常用参数

|        参数         |    功能     |
|:-----------------:|:---------:|
|        -V         |  显示版本信息   |
|        -h         |  显示帮助信息   |
|        -b         | 启动后转入后台执行 |
|        -c         |  支持断点续传   |
|        -O         |  定义本地文件名  |
|      -e <命令>      |  执行指定的命令  |
| --limit-rate=<速率> |  限制下载速度   |

3. 参考实例

下载指定的网络文件

```shell
wget https://www.linuxprobe.com/docs/LinuxProbe.pdf
```

下载指定的网络文件，并定义保存在本地的文件名称

```shell
wget -O Book.pdf https://www.linuxprobe.com/docs/LinuxProbe.pdf
```

下载指定的网络文件，限速最高每秒300k

```shell
wget --limit-rate=300k https://www.linuxprobe.com/docs/LinuxProbe.pdf
```

下载指定的网络文件，将任务放至后台执行

```shell
wget -b https://www.linuxprobe.com/docs/LinuxProbe.pdf
```

### 7.12.3 init 切换系统运行级别

init命令是Linux下的进程初始化工具，init进程是所有Linux进程的父进程，它的进程号为1。init命令是Linux操作系统中不可缺少的程序之一，init进程是Linux内核引导运行的，是系统中的第一个进程

1. 基本语法

init [参数]

2. 常用参数

| 参数  |   功能    |
|:---:|:-------:|
|  0  |   关机    |
|  1  |   单用户   |
|  2  |   多用户   |
|  3  | 完全多用户模式 |
|  5  |  图形界面   |
|  6  |   重启    |

3. 参考实例

关闭服务器

```shell
init 0
```

切换单用户模式

```shell
init 1
```

### 7.12.4 watch 周期性执行命令

watch命令以周期性的方式执行给定的指令，指令输出以全屏方式显示。watch是一个非常实用的命令，基本所有的Linux发行版都带有这个小工具，如同名字一样，watch可以帮你监测一个命令的运行结果，省得你一遍遍的手动运行。

1. 基本语法

watch [参数] [命令]

2. 常用参数

|        参数        |                                         功能                                          |
|:----------------:|:-----------------------------------------------------------------------------------:|
|  -n/--interval   |                      watch默认每2秒运行一下程序，可以用-n或-interval来指定间隔的时间                       |
| -d/--differences | 用-d或--differences 选项watch 会高亮显示变化的区域。 而-d=cumulative选项会把变动过的地方(不管最近的那次有没有变动)都高亮显示出来 |
|  -t/--no-title   |                            关闭watch命令在顶部的时间间隔、命令、当前时间的输出                             |
|    -h/--help     |                                       查看帮助文档                                        |

3. 参考实例

重复执行uptime命令

```shell
watch uptime
```

每隔一秒高亮显示网络链接数的变化情况

```shell
watch -n 1 -d netstat -ant
```

每10秒一次输出系统的平均负载

```shell
watch -n 10 'cat /proc/loadavg'
```

监测磁盘inode和block数目变化情况

```shell
watch -n 1 "df -i;df"
```

监测当前目录中test.txt文件的变化

```shell
watch -d 'ls -l|grep test.txt'
```

### 7.12.5 ifconfig 显示或设置网络设备参数信息

ifconfig命令来自于英文词组”network interfaces configuring“的缩写，其功能是用于显示或设置网络设备参数信息。在Windows系统中与之类似的命令叫做ipconfig，同样的功能可以使用ifconfig去完成。

通常不建议使用ifconfig命令配置网络设备的参数信息，因为一旦服务器重启，配置过的参数会自动失效，还是编写到配置文件中更稳妥。

1. 基本语法

ifconfig [参数] [网卡设备]

2. 常用参数

|   参数    |       功能        |
|:-------:|:---------------:|
| add<地址> | 设置网络设备IPv6的IP地址 |
| del<地址> | 删除网络设备IPv6的IP地址 |
|  down   |    关闭指定的网络设备    |
|   up    |    启动指定的网络设备    |
|  IP地址   |   指定网络设备的IP地址   |

3. 参考实例

显示系统的网络设备信息

```shell
ifconfig
```

对指定的网卡设备依次进行关闭和启动操作

```shell
ifconfig ens160 down
ifconfig ens160 up
```

对指定的网卡设备执行修改IP地址操

```shell
ifconfig ens160 192.168.10.20 netmask 255.255.255.0
```

对指定的网卡设备执行修改MAC地址操作

注意Linux系统中的MAC地址间隔符为冒号（：），而在Windows系统中间隔符为减号（-）

```shell
ifconfig ens160 hw ether 00:aa:bb:cc:dd:ee
```

### 7.12.6 tracepath 追踪报文的路由信息

tracepath命令用来追踪并显示报文到达目的主机所经过的路由信息，能够发现路由中的MTU值。tracepath使用套接字API来实现其所有功能，不需要root权限。

1. 语法格式

tracepath [参数] [域名]

2. 常用参数

| 参数  |          功能          |
|:---:|:--------------------:|
| -n  |       只显示ip地址        |
| -b  |     同时显示ip地址和主机名     |
| -l  | 设置初始化的数据包长度，默认为65535 |
| -m  |    设置最大TTL值，默认为30    |
| -p  |     设置要使用的初始目标端口     |

3. 参考实例

追踪到达域名的主机路由信息

```shell
tracepath www.linuxcool.com
```

追踪到达域名的主机路由信息(同时显示ip地址与主机名)

```shell
tracepath -b www.linuxcool.com
```

设置追踪报文路由的最大TTL值

```shell
tracepath -m 20 www.linuxcool.com
```

### 7.12.7 tr 字符转换

tr的英文全称是“ transform ”，即转换的意思。该命令的作用是一种可将字符进行替换、压缩、删除，他可以将一组字符转换成另一组字符。tr他只能从标准输入中读取数据，因此，tr要么将输入文件重定向到标准输入，要么从管道读入数据。

注意：tr类似于sed命令，但是比sed简单，所以tr能实现的功能，sed都能实现。

1. 基本语法

tr [参数] [字符串1] [字符串2]

2. 常用参数

| 参数  |            功能            |
|:---:|:------------------------:|
| -c  | 选定字符串1中字符集的补集，即反选字符串1的补集 |
| -d  |      删除字符串1中出现的所有字符      |
| -s  |   删除所有重复出现的字符序列，只保留一个    |

3. 参考实例

实现大小字母的转换

```shell
cat file_1
#abc 012
#def 345
#ghi 678
#jkl 909
tr "[a-z]" "[A-Z]" <file_1
#ABC 012
#DEF 345
#GHI 678
#JKL 909
```

删除file_1中的小写字母

```shell
tr -d "[a-z]" <file_1
#012
#345
#678
#909
```

### 7.12.8 uname 显示系统内核信息

uname命令来自于英文词组”Unix name“的缩写，其功能是用于查看系统主机名、内核及硬件架构等信息。如果不加任何参数，默认仅显示系统内核名称，相当于-s参数。

1. 基本语法

uname [参数]

2. 常用参数

| 参数  |     功能     |
|:---:|:----------:|
| -a  | 显示系统所有相关信息 |
| -m  | 显示计算机硬件架构  |
| -n  |   显示主机名称   |
| -r  | 显示内核发行版本号  |
| -s  |   显示内核名称   |
| -v  |   显示内核版本   |
| -p  | 显示主机处理器类型  |
| -o  |  显示操作系统名称  |
| -i  |   显示硬件平台   |

3. 参考实例

显示系统内核名称

```shell
uname
#Linux
```

显示系统所有相关信息（含内核名称、主机名、版本号及硬件架构）

```shell
uname -a
#Linux linuxcool.com 4.18.0-80.el8.x86_64 #1 SMP Wed Mar 13 12:02:46 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
```

显示系统内核版本号

```shell
uname -r 
#4.18.0-80.el8.x86_64
```

### 7.12.9 last 显示用户或终端的登录情况

last命令的作用是显示近期用户或终端的登录情况，通过查看系统记录的日志文件内容，进而使管理员可以获知谁曾经或者企图连接系统。

执行last命令时，它会读取/var/log目录下名称为wtmp的文件，并把该文件记录的登录系统或终端的用户名单全部显示出来。默认显示wtmp的记录，btmp能显示的更详细，可以显示远程登录，例如ssh登录。

1. 基本语法

last [选项]

2. 常用参数

|   参数    |       功能        |
|:-------:|:---------------:|
|   -R    |  省略hostname的栏位  |
| usename | 展示username的登入讯息 |
|   tty   |  限制登入讯息包含的终端代号  |

3. 参考实例

显示近期用户或终端的登录情况

```shell
last
```

简略显示，并指定显示的个数

```shell
last -n 5 -R
```

显示最后一列显示主机IP地址

```shell
last -n 5 -a -i
```

### 7.12.10 diff 比较文件的差异

diff以逐行的方式，比较文本文件的异同处。如果指定要比较目录，则diff会比较目录中相同文件名的文件，但不会比较其中子目录 

1. 基本语法

diff [参数] [目录]

2. 常用参数

|           参数            |                  功能                  |
|:-----------------------:|:------------------------------------:|
|           -a            |           diff预设只会逐行比较文本文件           |
|           -b            |              不检查空格字符的不同              |
|           -W            |            在使用-y参数时，指定栏宽             |
|           -x            |           不比较选项中所指定的文件或目录            |
|           -X            |  您可以将文件或目录类型存成文本文件，然后在=<文件>中指定此文本文件  |
|           -y            |           以并列的方式显示文件的异同之处            |
|         --help          |                查看帮助信息                |
|      --left-column      | 在使用-y参数时，若两个文件某一行内容相同，则仅在左侧的栏位显示该行内容 |
| --suppress-common-lines |           在使用-y参数时，仅显示不同之处           |

3. 参考实例

比较两个文件

```shell
diff log2014.log log2013.log 
```

并排格式输出

```shell
diff log2014.log log2013.log  -y -W 50
#2013-01                 2013-01
#2013-02                 2013-02
#2014-03               | 2013-03
#2013-04                 2013-04
#2013-05                 2013-05
#2013-06                 2013-06
#2013-07                 2013-07
#2013-07               | 2013-08
#2013-09                 2013-09
#2013-10                 2013-10
#2013-11               <
#2013-12               <
diff log2013.log log2014.log  -y -W 50
#2013-01                 2013-01
#2013-02                 2013-02
#2013-03               | 2014-03
#2013-04                 2013-04
#2013-05                 2013-05
#2013-06                 2013-06
#2013-07                 2013-07
#2013-08               | 2013-07
#2013-09                 2013-09
#2013-10                 2013-10
#                      > 2013-11
#                      > 2013-12
```

注意：”|”表示前后2个文件内容有不同，”<“表示后面文件比前面文件少了1行内容，”>”表示后面文件比前面文件多了1行内容

### 7.12.11 uniq 去除文件中的重复行

uniq命令全称是“unique”，中文释义是“独特的，唯一的”。该命令的作用是用来去除文本文件中连续的重复行，中间不能夹杂其他文本行。去除了重复的，保留的都是唯一的，也就是独特的，唯一的了

我们应当注意的是，它和sort的区别，sort只要有重复行，它就去除，而uniq重复行必须要连续，也可以用它忽略文件中的重复行。

1. 基本语法

uniq [参数] [文件]

2. 常用参数

| 参数  |          功能           |
|:---:|:---------------------:|
| -c  |    打印每行在文本中重复出现的次数    |
| -d  | 只显示有重复的纪录，每个重复纪录只出现一次 |
| -u  |      只显示没有重复的纪录       |

3. 参考实例

删除连续文件中连续的重复行

```shell
cat testfile 
#test 30  
#test 30 
#test 30  
#Hello 95  
#Hello 95  
#Hello 95  
#Hello 95  
#Linux 85
#Linux 85
uniq testfile 
#test 30  
#Hello 95  
#Linux 85
```

打印每行在文件中出现重复的次数

```shell
uniq -c testfile 
#3 test 30  
#4 Hello 95  
#2 Linux 85
```

只显示有重复的纪录，且每个纪录只出现一次

```shell
uniq -d testfile 
#test 30  
#Hello 95  
#Linux 85
```




