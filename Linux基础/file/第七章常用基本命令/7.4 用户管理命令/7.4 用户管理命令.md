# 7.4 用户管理命令

useradd命令来自于英文词组“User add”的全拼，其功能是用于创建并设置用户信息。使用useradd命令可以自动的完成创建用户的信息、基本组、家目录等工作，并在创建的过程中对用户初始信息进行定制

### 7.4.1 useradd 添加新用户

1. 基本语法

useradd [参数] 用户名

2. 常用参数

| 选项  |                      功能                      |
|:---:|:--------------------------------------------:|
| -D  |                  改变新建用户的预设值                  |
| -c  |                    添加备注文字                    |
| -d  |               新用户每次登陆时所使用的家目录                |
| -e  |           用户终止日期，日期的格式为YYYY-MM-DD            |
| -f  | 用户过期几日后永久停权。当值为0时用户立即被停权，而值为-1时则关闭此功能，预设值为-1 |
| -g  |                  指定用户对应的用户组                  |
| -G  |                定义此用户为多个不同组的成员                |
| -m  |                用户目录不存在时则自动创建                 |
| -M  |       不建立用户家目录，优先于/etc/login.defs文件设定        |
| -n  |                取消建立以用户名称为名的群组                |
| -r  |                    建立系统帐号                    |
| -u  |                    指定用户id                    |

3. 参考实例

添加一个用户

```shell
useradd tangseng
```

创建指定的用户信息，并追加指定组为该账户的扩展组

```shell
useradd -G root user4
```

创建指定的用户信息，并指定过期时间

```shell
useradd -e "2023/01/01" user5
```

创建指定的用户信息，并自定义UID值

```shell
useradd -u 6688 user3
```

### 7.4.2 passwd 设置用户密码

1. 基本语法

passwd [参数] 用户名

2. 常用参数

| 选项  |         功能         |
|:---:|:------------------:|
| -d  |        删除密码        |
| -l  |  锁定用户密码，无法被用户自行修改  |
| -u  | 解开已锁定用户密码，允许用户自行修改 |
| -e  | 密码立即过期，下次登陆强制修改密码  |
| -k  | 保留即将过期的用户在期满后能仍能使用 |
| -S  |       查询密码状态       |


3. 参考实例

修改当前登陆的账户密码

```shell
passwd
```

设置用户的密码

```shell
passwd tangseng
```

锁定密码不允许用户修改

```shell
passwd -l linuxcool
```

下次登陆强制改密码

```shell
passwd -e linuxcool
```

### 7.4.3 id 查看用户

id命令可以显示真实有效的用户ID(UID)和组ID(GID)。UID 是对一个用户的单一身份标识。组ID（GID）则对应多个UID。id命令已经默认预装在大多数Linux系统中。要使用它，只需要在你的控制台输入id。不带选项输入id会显示如下。结果会使用活跃用户。

当我们想知道某个用户的UID和GID时id命令是非常有用的。一些程序可能需要UID/GID来运行。id使我们更加容易地找出用户的UID以GID而不必在/etc/group文件中搜寻。如往常一样，你可以在控制台输入man id进入id的手册页来获取更多的详情。

1. 基本语法

id [参数] [用户名]

2. 常用参数

|    选项     |        功能         |
|:---------:|:-----------------:|
|    -g     |    显示用户所属群组的ID    |
|    -G     |   显示用户所属附加群组的ID   |
|    -n     | 显示用户，所属群组或附加群组的名称 |
|    -r     |      显示实际ID       |
|    -u     |      显示用户ID       |
|  --help   |       显示帮助        |
| --version |      显示版本信息       |

3. 参考实例

查看用户

```shell
id tangseng
```

### 7.4.4 cat /etc/passwd 查看创建了哪些用户

1. 参考实例

```shell
cat /etc/passwd
```

### 7.4.5 su 切换用户

su: swith user 切换用户

管理员切换至任意用户身份而无需密码验证，而普通用户切换至任意用户身份均需密码验证。另外添加单个减号（-）参数为完全的身份变更，不保留任何之前用户的环境变量信息。

1. 基本语法

su 用户名称 （功能描述：切换用户，只能获得用户的执行权限，不能获得环境变量）

su - 用户名称 （功能描述：切换到用户并获得该用户的环境变量及执行权限）

2. 参考实例

切换用户

```shell
sudu tangseng
```

### 7.4.6 userdel 删除用户

1. 基本语法

userdel [参数] [用户名]

2. 选项说明

| 选项  |       功能        |
|:---:|:---------------:|
| -f  |    强制删除用户账号     |
| -r  | 删除用户主目录及其中的任何文件 |
| -h  |    显示命令的帮助信息    |
3. 参考实例

* 删除用户（保存用户主目录）

```shell
userdel tangseng
```

* 删除用户和用户主目录，都删除

```shell
userdel -r zhubajie
```

强制删除用户

```shell
userdel -f linuxcool
```

### 7.4.7 who 查看登录用户信息

1. 基本语法

* who [参数] [选项]

* whoami （功能描述：显示自身用户名称）

* who am i （功能描述：显示登录用户的用户名以及登陆时间）

2. 常用参数

| 选项  |          功能          |
|:---:|:--------------------:|
| -a  |        打印全面信息        |
| -b  |      打印系统最近启动时间      |
| -d  |       打印死掉的进程        |
| -l  |       打印系统登录进程       |
| -H  | 带有列标题打印用户名，登录终端和登录时间 |
| -t  |      打印系统上次锁定时间      |
| -u  |      打印已登录用户列表       |

3. 参考实例

* 显示自身用户名称

```shell
whoami
```

* 显示登录用户的用户名

```shell
who am i
```

打印用户登录信息（-H 带有列标题打印）

```shell
who -H
```

打印系统最近启动时间

```shell
who -b
```

### 7.4.8 sudo 设置普通用户具有 root 权限

sudo命令来自于英文词组“super user do”的缩写，中文译为“超级用户才能干的事”，其功能是用于授权普通用户执行管理员命令。使用su命令变更用户身份虽然好用，但是需要将管理员的账户密码告诉他人，总感觉心里不踏实，幸好有了sudo服务。

使用sudo服务可以授权某个指定的用户去执行某些指定的命令，在满足工作需求的前提下尽可能少的放权，保证服务器的安全。配置sudo服务可以直接编辑配置文件/etc/sudoers，亦可以执行visudo命令进行设置，一切妥当后普通用户便能够使用sudo命令进行操作了。

1. 语法格式

sudo [参数] 命令

2. 常用参数

| 选项  |       功能        |
|:---:|:---------------:|
| -v  |  本次需要验证当前用户的密码  |
| -k  |  下次强制验证当前用户的密码  |
| -b  |  将要执行的指令放在后台执行  |
| -p  |  更改需要密码验证时的提示语  |
| -s  | 指定默认调用的SHELL解释器 |


3. 添加 atguigu 用户，并对其设置密码

```shell
useradd atguigu
passwd atguigu
```

2. 修改配置文件

```shell
vim /etc/sudoers
```

修改 /etc/sudoers 文件，找到下面一行(91 行)，在 root 下面添加一行，如下所示：

```text
## Allow root to run any commands anywhere
root    ALL=(ALL) ALL
atguigu ALL=(ALL) ALL
```

或者配置成采用 sudo 命令时，不需要输入密码

```text
## Allow root to run any commands anywhere
root    ALL=(ALL) ALL
atguigu ALL=(ALL) NOPASSWD:ALL
```

修改完毕，现在可以用 atguigu 帐号登录，然后用命令 sudo ，即可获得 root 权限进行操作。

### 7.4.9 usermod 修改用户

1. 基本语法

usermod [参数] 用户名

2. 选项说明

|     选项     |        功能         |
|:----------:|:-----------------:|
|  -c <备注>   |    修改用户账号的备注文字    |
| -d <登入目录>  |    修改用户登入时的家目录    |
| -e <有效期限>  |     修改账号的有效期限     |
| -f <缓冲天数>  | 修改在密码过期后多少天即关闭该账号 |
|  -g <群组>   |     修改用户所属的群组     |
|  -G <群组>   |    修改用户所属的附加群组    |
| -l <账号名称>  |     修改用户账号名称      |
|     -L     |   锁定用户密码，使密码无效    |
| -s <shell> | 修改用户登入后所使用的shell  |
|  -u <uid>  |      修改用户ID       |
|     -U     |      解除密码锁定       |

3. 参考实例

将用户加入到用户组

```shell
usermod -g root zhubajie
```

修改指定用户的家目录路径

```shell
usermod -d /home linuxprobe
```

修改指定用户的UID号码

```shell
usermod -u 6688 linuxprobe
```