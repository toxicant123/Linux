# 10.10 文本处理工具

## 10.1 cut

cut 的工作就是“剪”，具体的说就是在文件中负责剪切数据用的。cut 命令从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段输出

1. 基本用法

cut [参数] 文件名称

说明：默认分隔符是制表符

2. 常用参数

|               参数                | 功能  |
|:-------------------------------:|:---:|
|             选项参数 功能             |
|           -f 列号，提取第几列           |
|  -d 分隔符，按照指定分隔符分割列，默认是制表符“\t”   |
| -c 按字符进行切割 后加加 n 表示取第几列 比如 -c 1 |

3. 参考实例

数据准备

```shell
touch cut.txt
vim cut.txt
#dong shen
#guan zhen
#wo wo
#lai lai
#le le
```

切割 cut.txt 第一列

```shell
cut -d " " -f 1 cut.txt
#dong
#guan
#wo
#lai
#le
```

切割 cut.txt 第二、三列

```shell
cut -d " " -f 2,3 cut.txt
#shen
#zhen
# wo
# lai
# le
```

在 cut.txt 文件中切割出 guan

```shell
cat cut.txt |grep guan | cut -d " " -f 1
#guan
```

选取系统 PATH 变量值，第 2 个":"开始后的所有路径

```shell
echo $PATH
#/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/atguigu/.local/bin:/home/atguigu/bin
echo $PATH | cut -d ":" -f 3-
#/usr/local/sbin:/usr/sbin:/home/atguigu/.local/bin:/home/atguigu/bin
```

切割 ifconfig 后打印的 IP 地址

```shell
ifconfig ens33 | grep netmask | cut -d " " -f 10
#192.168.111.101
```

## 10.2 awk

一个强大的文本分析工具，把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行分析处理

1. 基本用法

awk [选项参数] '/pattern1/{action1} /pattern2/{action2}...' filename

pattern：表示 awk 在数据中查找的内容，就是匹配模式

action：在找到匹配内容时所执行的一系列命令

2. 常用参数

| 参数  |      功能       |
|:---:|:-------------:|
| -F  | 指定输入时用到的字段分隔符 |
| -v  |     自定义变量     |
| -f  |  从脚本中读取awk命令  |
| -m  |  对val值设置内在限制  |

内置变量：

|   变量名称   |          说明          |
|:--------:|:--------------------:|
|   ARGC   |       命令行参数个数        |
|   ARGV   |       命令行参数排列        |
| ENVIRON  |    支持队列中系统环境变量的使用    |
| FILENAME |      awk浏览的文件名       |
|   FNR    |       浏览文件的记录数       |
|    FS    | 设置输入域分隔符，等价于命令行 -F选项 |
|    NF    |      浏览记录的域的个数       |
|    NR    |        已读的记录数        |
|   OFS    |        输出域分隔符        |
|   ORS    |       输出记录分隔符        |
|    RS    |       控制记录分隔符        |

3. 参考实例

数据准备

```shell
sudo cp /etc/passwd ./
```

搜索 passwd 文件以 root 关键字开头的所有行，并输出该行的第 7 列

```shell
awk -F : '/^root/{print $7}' passwd
#/bin/bash
```

搜索 passwd 文件以 root 关键字开头的所有行，并输出该行的第 1 列和第 7 列，中间以','号分割

```shell
awk -F : '/^root/{print $1","$7}' passwd
#root,/bin/bash
```

注意：只有匹配了 pattern 的行才会执行 action

只显示/etc/passwd 的第一列和第七列，以逗号分割，且在所有行前面添加列名 user，shell 在最后一行添加"dahaige，/bin/zuishuai"

```shell
awk -F : 'BEGIN{print "user, shell"} {print $1","$7} END{print "dahaige,/bin/zuishuai"}' passwd
user, shell
root,/bin/bash
bin,/sbin/nologin
atguigu,/bin/bash
dahaige,/bin/zuishuai
```

注意：BEGIN 在所有数据读取行之前执行；END 在所有数据执行之后执行

将 passwd 文件中的用户 id 增加数值 1 并输出

```shell
awk -v i=1 -F : '{print $3+i}' passwd
#1
#2
#3
#4
```

统计 passwd 文件名，每行的行号，每行的列数

```shell
awk -F : '{print "filename:" FILENAME ",linenum:"NR ",col:"NF}' passwd
#filename:passwd,linenum:1,col:7
#filename:passwd,linenum:2,col:7
#filename:passwd,linenum:3,col:7
```

查询 ifconfig 命令输出结果中的空行所在的行号

```shell
ifconfig | awk '/^$/{print NR}'
#9
#18
#26
```

切割 IP

```shell
ifconfig ens33 | awk '/netmask/ {print $2}'
#192.168.6.101
```